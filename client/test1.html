<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Document</title>
    <link rel="stylesheet" href="./css/jquery.mobile-1.4.5.min.css">
    <link rel="stylesheet" href="./css/color.css">
    <link rel="stylesheet" href="./css/superMultiSelect.css">
    <style>
        body{
            overflow-y:hidden;
        }
        .tableWrapper { height: 600px; width: 100%; overflow-y: scroll; overflow-x: scroll;}

            td tr table { padding: 0; margin: 0; }
            table td {border-right: 1px solid lightgray;max-width: 150px; text-align: center;vertical-align: middle;white-space:nowrap;}
            table th {border-right: 1px solid lightgray;padding: 0; margin: 0;text-align: center;vertical-align: middle;}
            tr.focused { background-color: #ddd; }
            .font12{
                font-size: 12px;
            }
            .font12 label{
                font-size: 12px;
            }
            .font12 input[type=checkbox]{
                width: 16px;
                height:16px;
            }
            .hide{
                display:none;
            }
            @keyframes glowing-border {
                0% {
                box-shadow: 0 0 5px #1362B7;
                }
                50% {
                box-shadow: 0 0 20px #1362B7;
                }
                100% {
                box-shadow: 0 0 5px #1362B7;
                }
            }
            .newTableItem{
                animation: glowing-border 2s infinite;
            }
        </style>
    <script src="./js/jquery.js"></script>
    <script src="./js/jquery.mobile-1.4.5.min.js"></script>
    <script src="./js/crypto/core.js"></script>
    <script src="./js/crypto/lib-typedarrays.js"></script>
    <script src="./js/crypto/x64-core.js"></script>
    <script src="./js/crypto/enc-base64.js"></script>
    <script src="./js/crypto/cipher-core.js"></script>
    <script src="./js/crypto/aes.js"></script>
    <script type="module" src="./lazytable/main.js"></script>
    <script src="./utilities/tools.js"></script>
    <script src="./utilities/db.js"></script>
    <script src="./utilities/configs.js"></script>
    <script src="./utilities/resourceData.js"></script>
    <script src="./elements/superMutliSelect.js"></script>
    
</head>
<body>
    <script>
    function getSuperMultValue(template,data,isMultiInput){
        console.log('getSuperMultValue',data);
        var data=data.split(',');
        var multiValues=[];
        data.forEach(_v=>{
            var _values=isMultiInput?formatSuperMultiSelectData(_v):formatSuperMultiSelectOptionValue(_v);
            //console.log('setSumList',_values);
            if(template.hasOwnProperty('displayFormat')){
                var displayFormat=template.displayFormat;
                $.each(_values,(kk,vv)=>{
                    if(displayFormat.indexOf(kk)>-1){
                        displayFormat=displayFormat.replace("{"+kk+"}",vv);
                    }
                })
                multiValues.push(displayFormat);
            }else{
                var collector=[];
                $.each(_v,(kk,vv)=>{
                    collector.push(vv);
                })
                multiValues.push(collector.join(" "));
            }
        });
        return multiValues;
    }
    function getValueIfHaveDataRef(template,data){
        
        if(template.hasOwnProperty('data') && template.data!=undefined){
            var refData=template.data;
            //console.log('hasOwnProperty data',refData);
            if(template.type=='supermulticombobox'){
                return getSuperMultValue(template,data,false).join("<br/>");
            }else if(template.type=='supermultiinput'){
                return getSuperMultValue(template,data,true).join("<br/>");
            }else{
                var _data;
                if(template.hasOwnProperty('matchKey')){
                    refData=$.grep(refData,d=>d[template.matchKey]==data);
                }else{
                    refData=[refData[data]];
                }
                if(template.hasOwnProperty('valueKey')){
                    if(refData.length>0) _data = refData[0][template.valueKey];
                }else{
                    if(refData.length>0) _data = refData[0];
                }
                if(template.hasOwnProperty('displayFormat')){
                    _data=template.displayFormat.replace('{}',_data);
                }
                return _data;
            }
            
        }else {
            if(template.hasOwnProperty('displayFormat')){
                data=template.displayFormat.replace('{}',data);
            }
            return data;
        }
    }
    function getTdHtml(template,data,id){
        var td=$('<td name="'+id+'"" style="text-align: center;vertical-align: middle;"></td>');
        if(template.type!="checkbox" && template.type!="buttons"){
            data=getValueIfHaveDataRef(template,data);
            if(data==null||data.length==0) data=template.defaultValue!=undefined?template.defaultValue:"无";
        }
        var ele=$('<label>'+data+'</label>');
        switch(template.type){
            case "backgroundColorLabel":
                var ele=$('<label>'+data+'</label>');
                if(template.hasOwnProperty('backgroundData')){
                    td.css(template.backgroundData[data]);
                }
                break;
            case "date":
                console.log('date',data);
                var date=data;
                if(data=='0000-00-00 00:00:00'){
                    date=template.defaultValue!=undefined?template.defaultValue:"无";
                }else{
                    date=getDateTime(data);
                    if(template.dateFormat!=undefined) date=formatDateTime(new Date(data),template.dateFormat);
                }
                ele=$('<label>'+date+'</label>');
                break;
            case "checkbox":
                ele=$('<input class="reg-checkbox" style="left:0px;" type="checkbox" data-mini="true" name="item_checkbox" data-item='+data+'>');
                break;
            case "buttons":
                if(template.data!=undefined){
                    ele=$(template.data.replace("{0}",JSON.stringify(data)));
                }
                break;
                
        }
        if(template.isHidden){
            td.hide();
        }
        if(template.width!=undefined){
            td.css({width:template.width})
        }
        td.append(ele);
        //td.trigger('create');
        return td;
    }
    </script>
    
    
<script>
    var itemsPerPage=15;
    var currentPage=0;
    $('body').on(main_load_completed_event_name,function(){
        //console.log(DataList);
        const intervalId = setInterval(() => {
            if (_firstPageTableColumns!=undefined) {
                clearInterval(intervalId);
                var keys=Object.keys(_firstPageTableColumns);
                var tbody=$('<tbody></tbody>');
                $('#test_table').append(tbody);
                DataList.casesDb.forEach(function(row,index){
                    //$.each(data,(key,value)=>{
                        if(itemsPerPage<index) return false;
                        var tr=$('<tr></tr>');
                        keys.forEach(k=>{
                            if(row.hasOwnProperty(k)){
                                var td=getTdHtml(_firstPageTableColumns[k],row[k],k);
                                if(k=='caseApplicant') {
                                    console.log('caseApplicant',td)
                                }
                                tr.append(td);
                            }else{
                                if(_firstPageTableColumns[k].type=="checkbox" || _firstPageTableColumns[k].type=="buttons")
                                    tr.append(getTdHtml(_firstPageTableColumns[k],row,k));
                            }
                        })
                        tbody.append(tr);
                        console.log(itemsPerPage,index);
                        
                    //})
                })
                $('#test_table').trigger('create');
            }
        }, 100);

    });
    
</script>
<script src="./utilities/templates.js"></script>
<script src="./utilities/preload.js"></script>


<input id="filterTable-input" type="text">
<a href="#" id="columntToggle">test</a>
<div class="tableWrapper" >
      <table id="test_table" data-role="table" class="ui-responsive table-stroke" data-input="#filterTable-input">
      </table>
    </div>
    <div class="tableInfo">Rows: <span class="nRows"></span></div>
    <div class="focus"><label for="rowNumber">Focus: </label><input id="rowNumber" name= "rowNumber" type="number" min="1"/><button id="focus">Go</button></div>
</body>
</html>